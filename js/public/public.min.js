//Developed and created by Walid Bezoui
//Github: bezoui-software
//Mail: wbezoui@gmail.com

//Copyright 2020 - Walid Bezoui

//Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
//1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
//2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
//3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.

//BSD-3-Clause License:
//THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" 
//AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, 
//THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. 
//IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS 
//BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, 
//OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) 
//HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, 
//OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, 
//EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

!function(){let e;const t=Color(0,0,0);let n,i,o,s,a,h,l,w={width:40,height:20,min:{width:20,height:10},max:{width:200,height:180}},d=[];function r(){e=createCanvas(window.innerWidth,400),(h=new DOMElements).set({"speed-slider":{text:"Speed:",id:"speed-slider",type:"input",inputOptions:{type:"range",min:1,max:2e3,value:1,step:1}},"play-toggle":{text:"Play",id:"play-toggle",type:"button",events:{click:u}}}),h.generate(),h.render(),l=new Tester,spawnPosition=createVector(e.width/2,e.height-20),o=new Walls,(s=new Wall).color=Color(150,100),i=new Target(e.width/2,100),v(),e.elt.onclick=m,window.addEventListener("wheel",e=>{e.preventDefault(),e.deltaY<0?w.width<w.max.width&&w.height<w.max.height&&(w.width+=5,w.height+=5):w.width>w.min.width&&w.height>w.min.height&&(w.width-=5,w.height-=5)},{passive:!1}),window.addEventListener("keypress",e=>{const t=e.key.toLowerCase();switch(t){case"z":!function(){const e=o.pop();e&&(d.push(e),g(),p())}();break;case"e":!function(){const e=d.pop();e&&f(e)}();break;case"r":g(),p(),o=new Walls,d=[]}})}function c(){if(e){if(e.background(t),h.getEltOf("play-toggle").innerText=a?"Play":"Pause",!a)for(let e=0;e<h.valueOf("speed-slider");e++)n.update();n.show(),i.show(e),o.show(e),e.ctx.setLineDash([5,5]),s.set(e.mouseX,e.mouseY,w.width,w.height),s.color=Color(100,100,100,100),s.showOutline(e)}}function u(){a=!a}function p(){v()}function g(){l.clear(),l=new Tester}function f(e){o.add(e),g(),p()}function m(){var t,n;t=e.mouseX,n=e.mouseY,f(new Wall(t,n,w.width,w.height))}function v(){(n=new Population(spawnPosition.x,spawnPosition.y)).canvas=e,n.tester=l,n.target=i,n.walls=o,n.run()}window.addEventListener("load",function(){r(),setInterval(c,1/60)})}();